<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Video Converter</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #outputVideo, #outputGif { max-width: 100%; margin-top: 20px; }
    select, input, button { margin: 10px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Video Converter</h1>
  <input type="file" id="videoInput" accept="video/*">
  <select id="outputFormat">
    <option value="mp4">MP4</option>
    <option value="webm">WEBM</option>
    <option value="gif">GIF</option>
  </select>
  <button onclick="convertVideo()">Convert Video</button>
  <div id="status"></div>
  <video id="outputVideo" controls style="display:none;"></video>
  <img id="outputGif" style="display:none;" />

  <!-- Load FFmpeg from local path -->
  <script src="/assets/ffmpeg/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({
      corePath: "/assets/ffmpeg/ffmpeg-core.js",
      log: true
    });

    async function convertVideo() {
      const input = document.getElementById("videoInput").files[0];
      const format = document.getElementById("outputFormat").value;
      const status = document.getElementById("status");
      const outputVideo = document.getElementById("outputVideo");
      const outputGif = document.getElementById("outputGif");

      if (!input) {
        alert("Please select a video file.");
        return;
      }

      if (!ffmpeg.isLoaded()) {
        status.innerText = "Loading FFmpeg...";
        await ffmpeg.load();
      }

      status.innerText = "Processing...";
      const inputName = "input." + input.name.split('.').pop();
      const outputName = `output.${format}`;

      ffmpeg.FS("writeFile", inputName, await fetchFile(input));

      await ffmpeg.run("-i", inputName, outputName);

      const data = ffmpeg.FS("readFile", outputName);
      const url = URL.createObjectURL(new Blob([data.buffer], { type: `video/${format}` }));

      if (format === "gif") {
        outputVideo.style.display = "none";
        outputGif.src = url;
        outputGif.style.display = "block";
      } else {
        outputGif.style.display = "none";
        outputVideo.src = url;
        outputVideo.style.display = "block";
      }

      status.innerText = "Conversion complete.";
    }
  </script>
</body>
</html>
