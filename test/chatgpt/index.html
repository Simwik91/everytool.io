<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FFmpeg Browser Test</title>
</head>
<body>
  <h2>Select a WebM file to convert to MP4:</h2>
  <input type="file" id="uploader" accept=".webm" />
  <p id="status">Status: Idle</p>
  <video id="video" controls style="max-width: 100%; display: none;"></video>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;

    const ffmpeg = createFFmpeg({
      log: true,
      corePath: 'https://cdnjs.cloudflare.com/ajax/libs/ffmpeg/0.12.15/umd/814.ffmpeg.min.js',
    });

    const uploader = document.getElementById('uploader');
    const status = document.getElementById('status');
    const video = document.getElementById('video');

    uploader.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      status.textContent = 'Status: Loading FFmpeg...';
      await ffmpeg.load();

      status.textContent = 'Status: Writing file...';
      ffmpeg.FS('writeFile', 'input.webm', await fetchFile(file));

      status.textContent = 'Status: Converting...';
      await ffmpeg.run('-i', 'input.webm', '-c:v', 'libx264', '-c:a', 'aac', 'output.mp4');

      status.textContent = 'Status: Reading output...';
      const data = ffmpeg.FS('readFile', 'output.mp4');
      const blob = new Blob([data.buffer], { type: 'video/mp4' });
      const url = URL.createObjectURL(blob);

      video.src = url;
      video.style.display = 'block';
      status.textContent = 'Status: Done!';
    });
  </script>
</body>
</html>
