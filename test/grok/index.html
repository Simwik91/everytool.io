<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Converter</title>
</head>
<body>
    <h1>Video Converter</h1>
    <input type="file" id="videoInput" accept="video/*">
    <select id="outputFormat">
        <option value="mp4">MP4</option>
        <option value="webm">WebM</option>
    </select>
    <button id="convertButton">Convert</button>
    <a id="downloadLink" style="display:none;">Download Converted Video</a>
    <script type="module">
      import { FFmpeg } from 'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.15/dist/esm/ffmpeg.js';

      async function initFFmpeg() {
        const ffmpeg = new FFmpeg({
          coreURL: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.js',
          wasmURL: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.wasm',
          workerURL: 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/umd/ffmpeg-core.worker.js'
        });
        await ffmpeg.load();
        return ffmpeg;
      }

      document.getElementById('convertButton').addEventListener('click', async () => {
        const file = document.getElementById('videoInput').files[0];
        if (!file) {
          alert('Please select a video file');
          return;
        }

        const arrayBuffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(arrayBuffer);

        const ffmpeg = await initFFmpeg();

        ffmpeg.FS('writeFile', 'input', uint8Array);

        const format = document.getElementById('outputFormat').value;
        const outputFileName = `output.${format}`;

        await ffmpeg.run('-i', 'input', outputFileName);

        const data = ffmpeg.FS('readFile', outputFileName);

        const blob = new Blob([data.buffer], { type: `video/${format}` });
        const url = URL.createObjectURL(blob);
        document.getElementById('downloadLink').href = url;
        document.getElementById('downloadLink').download = outputFileName;
        document.getElementById('downloadLink').style.display = 'block';
      });
    </script>
</body>
</html>
